<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronóstico del Clima</title>
    {% include "./components/Navbar.html" %}
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css">
</head>

<body class="bg-gray-100">

    <div class="container mx-auto p-6">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-blue-600">Pronóstico del Clima</h1>
            <p class="text-lg">Consulta el clima por departamento</p>
        </header>

        <!-- Weather App -->
        <section id="weather-app">
            <div class="flex justify-center mb-4">
                <label for="departamento" class="text-xl mr-2">Selecciona un departamento:</label>
                <select id="departamento" class="p-2 border border-gray-300 rounded-md">
                    <!-- Aquí agregamos las opciones de los departamentos en el siguiente bloque de script -->
                </select>
                <button onclick="getWeatherData()" class="ml-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Consultar</button>
            </div>

            <!-- Spinner de carga -->
            <div id="loading" class="hidden text-center mt-5">
                <i class="wi wi-day-sunny text-6xl text-yellow-500"></i>
                <p class="mt-2 text-xl">Cargando datos...</p>
            </div>

            <!-- Contenedor de pronóstico -->
            <div id="forecast" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-10">
                <!-- Los datos del clima se insertarán aquí -->
            </div>
        </section>
    </div>

    <script>
        // Lista de departamentos con sus coordenadas
        const departamentos = {
            'San Salvador': {'lat': 13.692, 'lon': -89.2182},
            'Santa Ana': {'lat': 13.9946, 'lon': -89.5597},
            'San Miguel': {'lat': 13.4833, 'lon': -88.1833},
            'La Libertad': {'lat': 13.4904, 'lon': -89.2906},
            'Ahuachapán': {'lat': 13.9212, 'lon': -89.845},
            'Sonsonate': {'lat': 13.7184, 'lon': -89.7117},
            'Usulután': {'lat': 13.335, 'lon': -88.4419},
            'La Paz': {'lat': 13.524, 'lon': -88.9434},
            'Cabañas': {'lat': 13.850, 'lon': -88.8833},
            'Chalatenango': {'lat': 14.0333, 'lon': -88.9333},
            'Morazán': {'lat': 13.6667, 'lon': -88.1167},
            'San Vicente': {'lat': 13.6333, 'lon': -88.8},
            'Cuscatlán': {'lat': 13.7178, 'lon': -88.9019},
            'La Unión': {'lat': 13.3333, 'lon': -87.8333}
        };

        // Rellenar el dropdown con los departamentos
        const selectElement = document.getElementById('departamento');
        for (const departamento in departamentos) {
            const option = document.createElement('option');
            option.value = departamento;
            option.textContent = departamento;
            selectElement.appendChild(option);
        }

        function getWeatherData() {
            const departamento = document.getElementById('departamento').value;
            const { lat, lon } = departamentos[departamento];
            const url = `https://my.meteoblue.com/packages/basic-day?lat=${lat}&lon=${lon}&apikey=CfLoPjnKHuRGYIp8`;


            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('forecast').innerHTML = ''; 

        
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('No se pudieron obtener los datos del clima');
                    }
                    return response.json();
                })
                .then(data => {
                    // Ocultar el spinner
                    document.getElementById('loading').classList.add('hidden');
                    
                    const forecastContainer = document.getElementById('forecast');
                    const dataDay = data.data_day || {};
                    const days = dataDay.time || [];

                    days.forEach((day, index) => {
                        const dayElement = document.createElement('div');
                        dayElement.classList.add('p-4', 'bg-white', 'shadow', 'rounded-md', 'text-center');
                        dayElement.innerHTML = `
                            <h4 class="text-xl font-semibold">${day}</h4>
                            <i class="wi wi-day-sunny text-4xl text-yellow-500"></i>
                            <p class="mt-2">Máx: ${dataDay.temperature_max[index] || 'No disponible'}°C</p>
                            <p class="mt-1">Mín: ${dataDay.temperature_min[index] || 'No disponible'}°C</p>
                        `;
                        forecastContainer.appendChild(dayElement);
                    });
                })
                .catch(error => {
                    document.getElementById('loading').classList.add('hidden');
                    alert(error.message);
                });
        }
    </script>
</body>

</html>
